<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LP Studios | Panel de Administración</title>

  <!-- ===== Bootstrap ===== -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <!-- ===== Estilos locales ===== -->
  <link rel="stylesheet" href="/assets/stylesheets/fearless.css">
</head>

<body class="bg-dark text-light">

  <!-- ===== NAVBAR ===== -->
  <nav class="navbar navbar-dark bg-dark border-bottom shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-semibold" href="/">LP Studios</a>
      <div class="ms-auto d-flex gap-2">
        <a class="btn btn-outline-light btn-sm" href="/shop">🛒 Tienda</a>
        <a class="btn btn-outline-warning btn-sm position-relative" href="/admin/balance/requests">
          <i class="bi bi-bell-fill"></i> Solicitudes
          <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">5</span>
        </a>
        <a class="btn btn-outline-danger btn-sm" href="/admin">👨‍💼 Admin</a>
        <a class="btn btn-outline-light btn-sm" href="/logout">
          <i class="bi bi-box-arrow-right me-1"></i> Salir
        </a>
      </div>
    </div>
  </nav>

  <!-- ===== MAIN CONTENT ===== -->
  <main class="container-fluid p-0">
    <div class="container py-5">

      <!-- ===== Encabezado ===== -->
      <div class="row mb-4">
        <div class="col">
          <h1 class="fw-bold">👨‍💼 Panel de Administración</h1>
          <p class="text-light">Bienvenido, <strong>Administrador</strong></p>
        </div>
      </div>

      <!-- ===== Estadísticas ===== -->
      <div class="row g-4 mb-4">
        <div class="col-md-4">
          <div class="card bg-primary text-white shadow-sm border-0">
            <div class="card-body text-center">
              <h5 class="card-title">👥 Usuarios</h5>
              <h2>0</h2>
              <a href="/admin/users" class="text-white text-decoration-none">Ver todos →</a>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card bg-success text-white shadow-sm border-0">
            <div class="card-body text-center">
              <h5 class="card-title">🎬 Productos</h5>
              <h2>0</h2>
              <a href="/admin/media" class="text-white text-decoration-none">Gestionar →</a>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card bg-info text-white shadow-sm border-0">
            <div class="card-body text-center">
              <h5 class="card-title">👨‍💼 Admins</h5>
              <h2>1</h2>
              <p class="mb-0">Administradores activos</p>
            </div>
          </div>
        </div>
      </div>

      <!-- ===== Accesos rápidos ===== -->
      <div class="row g-4">
        <div class="col-md-6">
          <div class="card shadow-sm border-0">
            <div class="card-header bg-dark text-white">
              <h5 class="mb-0">🎬 Gestión de Productos</h5>
            </div>
            <div class="card-body">
              <p>Crear, editar y eliminar productos multimedia.</p>
              <a href="/admin/media" class="btn btn-primary me-2">Ver productos</a>
              <a href="/admin/media/new" class="btn btn-success">➕ Nuevo producto</a>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card shadow-sm border-0">
            <div class="card-header bg-dark text-white">
              <h5 class="mb-0">📁 Gestión de Categorías</h5>
            </div>
            <div class="card-body">
              <p>Organizar productos en categorías jerárquicas.</p>
              <a href="/admin/categories" class="btn btn-primary">
                <i class="bi bi-folder-fill me-2"></i> Ver categorías
              </a>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card shadow-sm border-0">
            <div class="card-header bg-danger text-white">
              <h5 class="mb-0">🔥 Gestión de Promociones</h5>
            </div>
            <div class="card-body">
              <p>Crear y administrar descuentos temporales.</p>
              <a href="/admin/promotions" class="btn btn-danger">
                <i class="bi bi-percent me-2"></i> Ver promociones
              </a>
              <div class="mt-3 text-muted small">
                Activas: <strong>0</strong> | Próximas: <strong>0</strong>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card shadow-sm border-0">
            <div class="card-header bg-dark text-white">
              <h5 class="mb-0">👥 Gestión de Usuarios</h5>
            </div>
            <div class="card-body">
              <p>Ver y administrar usuarios del sistema.</p>
              <a href="/admin/users" class="btn btn-primary">Ver usuarios</a>
            </div>
          </div>
        </div>

        <div class="col-md-12">
          <div class="card shadow-sm border-0">
            <div class="card-header bg-dark text-white">
              <h5 class="mb-0">📊 Estadísticas Avanzadas</h5>
            </div>
            <div class="card-body">
              <p>Ver estadísticas detalladas, ingresos, distribución de productos y más.</p>
              <a href="/admin/statistics" class="btn btn-info">📈 Ver estadísticas completas</a>
            </div>
          </div>
        </div>
      </div>

      <!-- ===== Productos más descargados ===== -->
      <div class="row mt-5">
        <div class="col">
          <h3 class="fw-bold">⭐ Productos más descargados</h3>
          <div class="table-responsive">
            <table class="table table-dark table-striped align-middle">
              <thead>
                <tr>
                  <th>Título</th>
                  <th>Tipo</th>
                  <th>Precio</th>
                  <th>Rating</th>
                  <th>Descargas</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="5" class="text-center text-muted py-3">No hay productos disponibles</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- ===== SCRIPTS ===== -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // Cargar estadísticas del dashboard
    async function loadDashboardStats() {
      try {
        // Cargar usuarios
        const usersResponse = await fetch('/api/users');
        const usersData = await usersResponse.json();
        const totalUsers = usersData.users.length;
        const totalAdmins = usersData.users.filter(u => u.isAdmin).length;
        
        // Cargar productos
        const mediaResponse = await fetch('/api/media');
        const mediaData = await mediaResponse.json();
        const totalProducts = mediaData.products.length;
        
        // Actualizar las tarjetas del dashboard
        document.querySelectorAll('.card h2')[0].textContent = totalUsers;
        document.querySelectorAll('.card h2')[1].textContent = totalProducts;
        document.querySelectorAll('.card h2')[2].textContent = totalAdmins;
        
      } catch (error) {
        console.error('Error cargando estadísticas del dashboard:', error);
      }
    }
    
    // Ejecutar al cargar la página
    window.addEventListener('DOMContentLoaded', loadDashboardStats);
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tienda — LP Studios</title>

  <!-- ===== Bootstrap ===== -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <!-- ===== Estilos locales ===== -->
  <link rel="stylesheet" href="/assets/stylesheets/fearless.css">
</head>

<body class="bg-dark text-light">

  <!-- ===== NAVBAR ===== -->
  <nav class="navbar navbar-dark bg-dark border-bottom shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-semibold" href="/">LP Studios</a>
      <div class="ms-auto d-flex gap-2">
        <a class="btn btn-outline-light btn-sm" href="/shop">🛍️ Tienda</a>
        <a class="btn btn-outline-light btn-sm" href="/login">🔑 Login</a>
        <a class="btn btn-warning btn-sm text-dark" href="/register">🧾 Registro</a>
      </div>
    </div>
  </nav>

  <!-- ===== MAIN CONTENT ===== -->
  <main class="container py-5">
    <h1 class="text-center mb-5">🎬 Catálogo de Medios</h1>

    <div class="row">
      <!-- ===== SIDEBAR: FILTROS ===== -->
      <aside class="col-md-3 mb-4">
        <div class="card bg-dark border-secondary shadow-sm">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">🔍 Filtros</h5>
          </div>
          <div class="card-body">
            <!-- Búsqueda -->
            <form method="GET" class="mb-4">
              <label class="form-label fw-bold">Buscar</label>
              <input type="text" class="form-control form-control-sm" name="q" placeholder="Buscar productos...">
              <button type="submit" class="btn btn-primary btn-sm w-100 mt-2">Buscar</button>
            </form>

            <hr class="border-secondary">

            <!-- Filtro por tipo -->
            <div class="mb-3">
              <label class="form-label fw-bold">Tipo</label>
              <div class="list-group mb-4">
                <a href="/shop" class="list-group-item list-group-item-action active">📚 Todos</a>
                <a href="/shop?type=image" class="list-group-item list-group-item-action">🖼️ Imágenes</a>
                <a href="/shop?type=audio" class="list-group-item list-group-item-action">🎵 Audio</a>
                <a href="/shop?type=video" class="list-group-item list-group-item-action">🎬 Video</a>
              </div>
            </div>

            <hr class="border-secondary">

            <!-- Filtro por categoría -->
            <div>
              <label class="form-label fw-bold">Categorías</label>
              <div class="list-group">
                <a href="/shop" class="list-group-item list-group-item-action active">
                  📂 Todas <span class="badge bg-secondary float-end">0</span>
                </a>
                <a href="/shop?category=1" class="list-group-item list-group-item-action">
                  📁 Música <span class="badge bg-secondary float-end">10</span>
                </a>
                <a href="/shop?category=2" class="list-group-item list-group-item-action">
                  📁 Videos <span class="badge bg-secondary float-end">5</span>
                </a>
                <a href="/shop?category=3" class="list-group-item list-group-item-action">
                  📁 Imágenes <span class="badge bg-secondary float-end">8</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </aside>

      <!-- ===== CONTENIDO PRINCIPAL: PRODUCTOS ===== -->
      <section class="col-md-9">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2>Catálogo</h2>
          <span class="text-muted">Mostrando 1 producto(s)</span>
        </div>

        <!-- Mensaje de info si no hay productos -->
        <!--
        <div class="alert alert-info">
          <i class="bi bi-info-circle me-2"></i>
          No se encontraron productos con los filtros aplicados.
          <a href="/shop" class="alert-link">Ver todos</a>
        </div>
        -->

        <!-- Grid de productos -->
        <div class="row g-3" id="products-grid">
          <!-- Producto Ejemplo -->
          <div class="col-12 col-sm-6 col-lg-4">
            <div class="card bg-dark border-secondary h-100 shadow-sm">
              <div class="ratio ratio-16x9">
                <img src="/assets/images/placeholder.jpg" alt="Producto ejemplo" class="card-img-top rounded-top">
              </div>
              <div class="card-body">
                <h5 class="card-title">Producto Ejemplo</h5>
                <p class="card-text small text-muted">Descripción breve del producto.</p>

                <p class="card-text mb-2">
                  <small class="text-muted">📁 <a href="/shop?category=1">Música</a></small>
                </p>

                <div class="mb-2">
                  <span class="badge bg-success">✅ Disponible (10 unidades)</span>
                </div>

                <div class="d-flex justify-content-between align-items-center">
                  <span class="fw-semibold">$99.99</span>
                  <div class="btn-group">
                    <a class="btn btn-outline-info btn-sm" href="../product_detail.html" title="Ver detalles">👁️</a>
                    <button class="btn btn-primary btn-sm">🛒 Agregar</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- ===== FOOTER ===== -->
  <footer class="text-center text-muted py-4 mt-5 border-top">
    <small>© 2025 LP Studios — Fearless Design. Timeless Sound.</small>
  </footer>

  <!-- ===== SCRIPTS ===== -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // Cargar productos dinámicamente
    async function loadProducts() {
      try {
        const response = await fetch('/api/media');
        const data = await response.json();
        const products = data.products;
        
        const grid = document.getElementById('products-grid');
        
        if (products.length === 0) {
          grid.innerHTML = `
            <div class="col-12">
              <div class="alert alert-info">
                <i class="bi bi-info-circle me-2"></i>
                No hay productos disponibles en este momento.
              </div>
            </div>
          `;
          return;
        }
        
        // Generar cards de productos
        grid.innerHTML = products.map(product => `
          <div class="col-12 col-sm-6 col-lg-4">
            <div class="card bg-dark border-secondary h-100 shadow-sm">
              <img src="https://via.placeholder.com/400x300/1a1a2e/eee?text=${encodeURIComponent(product.title)}" 
                   class="card-img-top" 
                   alt="${product.title}"
                   style="height: 200px; object-fit: cover;">
              <div class="card-body">
                <h5 class="card-title text-white">${product.title}</h5>
                <p class="card-text small text-muted">ID: ${product.id}</p>

                <div class="mb-2">
                  <span class="badge ${product.stock > 0 ? 'bg-success' : 'bg-danger'}">
                    ${product.stock > 0 ? `✅ Disponible (${product.stock} unidades)` : '❌ Agotado'}
                  </span>
                  <span class="badge bg-info">${product.mediaType}</span>
                </div>

                <div class="d-flex justify-content-between align-items-center">
                  <span class="fw-semibold fs-5 text-success">$${product.price}</span>
                  <div class="btn-group">
                    <a class="btn btn-outline-info btn-sm" href="/shop/${product.id}" title="Ver detalles">👁️</a>
                    <button class="btn btn-primary btn-sm ${product.stock <= 0 ? 'disabled' : ''}" 
                            onclick="addToCart(${product.id})">🛒</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `).join('');
        
        // Actualizar contador
        document.querySelector('.d-flex.justify-content-between span').textContent = 
          `Mostrando ${products.length} producto(s)`;
          
      } catch (error) {
        console.error('Error cargando productos:', error);
        document.getElementById('products-grid').innerHTML = `
          <div class="col-12">
            <div class="alert alert-danger">
              ❌ Error al cargar productos
            </div>
          </div>
        `;
      }
    }
    
    function addToCart(productId) {
      // TODO: Implementar agregar al carrito
      alert(`Producto ${productId} agregado al carrito`);
    }
    
    // Cargar al inicio
    window.addEventListener('DOMContentLoaded', loadProducts);
  </script>
</body>
</html>

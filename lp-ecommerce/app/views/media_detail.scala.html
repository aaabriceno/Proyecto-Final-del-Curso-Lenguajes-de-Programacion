@(m: models.Media)(implicit request: play.api.mvc.RequestHeader)
@main(m.title) {
  <div class="container py-4">
    <a href='@routes.ShopController.list' class="btn btn-link">&larr; Volver a la tienda</a>
    <div class="row g-4 mt-1">
      <div class="col-12 col-lg-7">
        <div class="ratio ratio-16x9">
          @m.mtype match {
            case models.MediaType.Image => {
              <img alt="@m.title" src='@routes.Assets.versioned(m.assetPath)' class="img-fluid rounded">
            }
            case models.MediaType.Audio => {
              <audio controls class="w-100">
                <source src='@routes.Assets.versioned(m.assetPath)' type="audio/mpeg">
              </audio>
            }
            case models.MediaType.Video => {
              <video controls class="w-100">
                <source src='@routes.Assets.versioned(m.assetPath)' type="video/mp4">
              </video>
            }
          }
        </div>
      </div>
      <div class="col-12 col-lg-5">
        <h2 class="mb-2">@m.title</h2>
        <p class="text-muted">@m.description</p>
        <p class="mb-2">Descargas: <strong>@m.downloads</strong> &middot; Rating: <strong>@("%.1f".format(m.rating))</strong></p>
        <h3 class="mb-3">$@{f"${m.price}%.2f"}</h3>
        
        @request.session.get("userEmail") match {
          case Some(email) => {
            @defining(models.UserRepo.findByEmail(email)) { userOpt =>
              @userOpt match {
                case Some(user) if user.isAdmin => {
                  <div class="alert alert-info">
                    <i class="bi bi-shield-check me-2"></i>
                    <strong>Modo Administrador</strong>
                    <br>Los administradores no pueden realizar compras.
                  </div>
                  <a href="@routes.AdminController.dashboard" class="btn btn-primary btn-lg w-100">
                    <i class="bi bi-speedometer2 me-2"></i>Ir al Panel Admin
                  </a>
                }
                case Some(user) => {
                  <a href="@routes.PurchaseController.showPurchasePage(m.id)" class="btn btn-success btn-lg w-100">
                    <i class="bi bi-cart-check me-2"></i>Comprar Ahora
                  </a>
                  <a href="@routes.PurchaseController.showDownloads" class="btn btn-outline-primary w-100 mt-2">
                    <i class="bi bi-download me-2"></i>Mis Descargas
                  </a>
                }
                case None => {
                  <a href="@routes.AuthController.loginForm" class="btn btn-primary btn-lg w-100">
                    <i class="bi bi-box-arrow-in-right me-2"></i>Inicia sesión para comprar
                  </a>
                }
              }
            }
          }
          case None => {
            <a href="@routes.AuthController.loginForm" class="btn btn-primary btn-lg w-100">
              <i class="bi bi-box-arrow-in-right me-2"></i>Inicia sesión para comprar
            </a>
          }
        }
      </div>
    </div>
  </div>
}

@(users: Vector[models.User], admin: models.User)(implicit req: RequestHeader, flash: Flash, messages: play.api.i18n.Messages)

@main("Gesti√≥n de Usuarios") {
  <div class="container mt-4">
    <div class="row mb-4">
      <div class="col">
        <h1 class="text-white">üë• Gesti√≥n de Usuarios</h1>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="@routes.AdminController.dashboard" class="text-white">Dashboard</a></li>
            <li class="breadcrumb-item active text-light">Usuarios</li>
          </ol>
        </nav>
      </div>
    </div>

    @* Mensajes flash *@
    @flash.get("success").map { msg =>
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        ‚úÖ @msg
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    }

    <div class="card">
      <div class="card-header bg-dark text-white">
        <h5 class="mb-0">Total de usuarios: @users.size</h5>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-dark table-hover mb-0">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Email</th>
                <th>Tel√©fono</th>
                <th>Saldo</th>
                <th>Gastado</th>
                <th>Rol</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              @for(user <- users) {
                <tr>
                  <td>@user.id</td>
                  <td>@user.name</td>
                  <td>@user.email</td>
                  <td>@user.phone</td>
                  <td>
                    <span class="badge bg-success">
                      $@{f"${user.balance}%.2f"}
                    </span>
                  </td>
                  <td>
                    <span class="badge bg-info">
                      $@{f"${user.totalSpent}%.2f"}
                    </span>
                  </td>
                  <td>
                    @if(user.isAdmin) {
                      <span class="badge bg-danger">üë®‚Äçüíº Admin</span>
                    } else {
                      <span class="badge bg-secondary">üë§ Usuario</span>
                    }
                  </td>
                  <td>
                    @if(user.isActive) {
                      <span class="badge bg-success">‚úÖ Activo</span>
                    } else {
                      <span class="badge bg-warning">‚ö†Ô∏è Inactivo</span>
                    }
                  </td>
                  <td>
                    @if(user.id != admin.id) {
                      <form method="POST" action="@routes.AdminController.toggleUserActive(user.id)" style="display:inline;">
                        @helper.CSRF.formField
                        <button type="submit" class="btn btn-sm @if(user.isActive) {btn-warning} else {btn-success}">
                          @if(user.isActive) {üö´ Desactivar} else {‚úÖ Activar}
                        </button>
                      </form>
                      
                      <button type="button" class="btn btn-sm btn-primary" 
                              data-bs-toggle="modal" 
                              data-bs-target="#addBalanceModal@user.id">
                        üí∞ Agregar Saldo
                      </button>
                      
                      @* Modal para agregar saldo *@
                      <div class="modal fade" id="addBalanceModal@user.id" tabindex="-1">
                        <div class="modal-dialog">
                          <div class="modal-content bg-dark text-white">
                            <div class="modal-header">
                              <h5 class="modal-title">Agregar Saldo a @user.name</h5>
                              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <form method="POST" action="@routes.AdminController.addBalance(user.id)">
                              @helper.CSRF.formField
                              <div class="modal-body">
                                <div class="mb-3">
                                  <label class="form-label">Saldo actual: <strong>$@{f"${user.balance}%.2f"}</strong></label>
                                </div>
                                <div class="mb-3">
                                  <label for="amount@user.id" class="form-label">Monto a agregar:</label>
                                  <input type="number" 
                                         class="form-control" 
                                         id="amount@user.id" 
                                         name="amount" 
                                         step="0.01" 
                                         min="0.01" 
                                         placeholder="50.00"
                                         required>
                                </div>
                              </div>
                              <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                <button type="submit" class="btn btn-success">üí∞ Agregar Saldo</button>
                              </div>
                            </form>
                          </div>
                        </div>
                      </div>
                    } else {
                      <span class="text-muted">T√∫</span>
                    }
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
}

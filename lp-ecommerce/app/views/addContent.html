<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LP Studios | Crear Producto</title>

  <!-- ===== Bootstrap ===== -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <!-- ===== Estilos locales ===== -->
  <link rel="stylesheet" href="/assets/stylesheets/fearless.css">
</head>

<body class="bg-dark text-light">

  <!-- ===== NAVBAR ADMIN ===== -->
  <nav class="navbar navbar-dark bg-dark border-bottom shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-semibold" href="/">LP Studios</a>
      <div class="ms-auto d-flex gap-2">
        <a class="btn btn-outline-danger btn-sm" href="/admin">👨‍💼 Admin</a>
        <a class="btn btn-outline-light btn-sm" href="/login">
          <i class="bi bi-box-arrow-right me-1"></i> Salir
        </a>
      </div>
    </div>
  </nav>

  <!-- ===== MAIN CONTENT ===== -->
  <main class="container py-5">
    <!-- ===== Header ===== -->
    <div class="row mb-4">
      <div class="col">
        <h1 class="fw-bold">➕ Crear Nuevo Producto</h1>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a href="/admin" class="text-white text-decoration-none">Dashboard</a>
            </li>
            <li class="breadcrumb-item">
              <a href="/admin/media" class="text-white text-decoration-none">Productos</a>
            </li>
            <li class="breadcrumb-item active text-light" aria-current="page">Nuevo</li>
          </ol>
        </nav>
      </div>
    </div>

    <!-- ===== Formulario de Creación ===== -->
    <div class="card shadow-sm border-0">
      <div class="card-header bg-success text-white">
        <h5 class="mb-0">🆕 Agregar Nuevo Producto</h5>
      </div>
      <div class="card-body">
        <form id="content-form" method="POST" action="/admin/media">
          
          <div class="mb-3">
            <label for="content-title" class="form-label">Título *</label>
            <input type="text" id="content-title" name="title" class="form-control" required>
          </div>

          <div class="mb-3">
            <label for="content-price" class="form-label">Precio ($) *</label>
            <input type="number" id="content-price" name="price" class="form-control" step="0.01" min="0" required>
          </div>

          <div class="mb-3" id="stock-field" style="display:none;">
            <label for="content-stock" class="form-label">Stock *</label>
            <input type="number" id="content-stock" name="stock" class="form-control" min="0" value="0">
            <div class="form-text">Solo aplica para productos físicos (hardware).</div>
          </div>

          <!-- ===== SELECTOR DE TIPO DE PRODUCTO ===== -->
          <div class="mb-3">
            <label for="productType" class="form-label fw-bold">Tipo de Producto *</label>
            <select id="productType" name="productType" class="form-select" required>
              <option value="">-- Selecciona tipo --</option>
              <option value="digital">💾 Digital (Descargable)</option>
              <option value="hardware">🖥️ Hardware (Físico)</option>
            </select>
            <div class="form-text">
              <i class="bi bi-info-circle"></i> 
              <strong>Digital:</strong> Contenido multimedia descargable (música, videos, diseño).
              <strong>Hardware:</strong> Productos físicos (smartphones, laptops, accesorios).
            </div>
          </div>

          <div class="mb-3">
            <label for="content-url" class="form-label">URL del archivo</label>
            <div class="input-group">
              <input type="text" id="content-url" name="url" class="form-control" placeholder="Ej: /assets/images/digital/games/action/imagen.jpg">
              <button type="button" class="btn btn-outline-secondary" id="browse-btn" data-bs-toggle="modal" data-bs-target="#fileBrowserModal">
                <i class="bi bi-folder2-open"></i> Buscar
              </button>
            </div>
            <div class="form-text">Ruta del archivo multimedia (opcional)</div>
          </div>

          <div class="mb-3">
            <label for="content-description" class="form-label">Descripción</label>
            <textarea id="content-description" name="description" class="form-control" rows="3" placeholder="Descripción del producto..."></textarea>
          </div>

          <!-- ===== SELECTOR EN CASCADA DE CATEGORÍAS ===== -->
          <div class="mb-3">
            <label class="form-label fw-bold">Categoría *</label>
            
            <!-- Nivel 1: Raíz -->
            <div class="mb-2">
              <label for="level1-select" class="form-label small">Nivel 1:</label>
              <select id="level1-select" class="form-select">
                <option value="">-- Selecciona nivel 1 --</option>
              </select>
            </div>
            
            <!-- Nivel 2 -->
            <div class="mb-2" id="level2-container" style="display: none;">
              <label for="level2-select" class="form-label small">Nivel 2:</label>
              <select id="level2-select" class="form-select">
                <option value="">-- Selecciona nivel 2 --</option>
              </select>
            </div>
            
            <!-- Nivel 3 -->
            <div class="mb-2" id="level3-container" style="display: none;">
              <label for="level3-select" class="form-label small">Nivel 3:</label>
              <select id="level3-select" class="form-select">
                <option value="">-- Selecciona nivel 3 --</option>
              </select>
            </div>
            
            <!-- Nivel 4 (categoría final) -->
            <div class="mb-2" id="level4-container" style="display: none;">
              <label for="level4-select" class="form-label small">Categoría final:</label>
              <select id="level4-select" class="form-select">
                <option value="">-- Selecciona categoría final --</option>
              </select>
            </div>
            
            <input type="hidden" id="final-category-id" name="categoryId">
            
            <div class="form-text">
              <i class="bi bi-info-circle"></i> 
              Selecciona primero el <strong>tipo de producto</strong> para ver las categorías disponibles
            </div>
          </div>

          <hr>

          <!-- Botones -->
          <div class="d-flex flex-wrap gap-2">
            <button type="submit" class="btn btn-success">
              <i class="bi bi-cloud-upload me-2"></i> Crear Producto
            </button>
            <a href="/admin/media" class="btn btn-secondary">
              <i class="bi bi-x-circle me-2"></i> Cancelar
            </a>
          </div>
        </form>
      </div>
    </div>
  </main>

  <!-- ===== SCRIPTS ===== -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/assets/javascripts/addContent.js"></script>
</body>
</html>

<!-- ===== MODAL EXPLORADOR DE ARCHIVOS ===== -->
<div class="modal fade" id="fileBrowserModal" tabindex="-1" aria-labelledby="fileBrowserModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="fileBrowserModalLabel">Seleccionar Archivo de Imagen</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="file-list" class="list-group">
          <!-- Los archivos se cargarán aquí -->
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
      </div>
    </div>
  </div>
</div>
